<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
    <head>
        <title>CPAN digest</title>
        <link rel="stylesheet" type="text/css" href="bootstrap.css">
        <style type="text/css">
            body {padding: 20px 0 0 20px;}
            #offset {width: 6em;}
        </style>
        <script id="itemTemplate" type="text/x-jquery-tmpl"> 
            <li><a href="http://metacpan.org/release/${author}/${name}">${name}</a> ${abstract}</li>
        </script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                var getStartDate = function() {
                    var startDate = new Date();
                    startDate.setDate(startDate.getDate() - $('#offset').val());
                    return startDate;
                };
                var loadData = function(startDate) {
                    var url = 'http://api.metacpan.org/v0/release/_search?callback=?&fields=name,distribution,author,abstract&sort=date:desc&q=status:(cpan OR latest) AND release.date:["' + startDate + '" TO *]&size=100';
                    $.getJSON(url, function(data) {
                        $('#list').empty();
                        var seen = {};
                        var list = [];
                        $.each(data.hits.hits, function(index, value) {
                            if (!seen[value.fields.distribution]) {
                                list.push(value.fields);
                                seen[value.fields.distribution] = 1;
                            }
                        });
                        $('#itemTemplate').tmpl(list).appendTo('#list');
                    });
                };
                var refresh = function() {
                    var startDate = getStartDate();
                    loadData(startDate.getFullYear() + '-' + (1 + startDate.getMonth()) + '-' + startDate.getDate() + 'T00:00:00');
                };
                $('#offset').change(refresh);
                refresh();
            });
        </script>
    </head>
    <body>
        <a href="http://github.com/komarov/cpan-digest"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/71eeaab9d563c2b3c590319b398dd35683265e85/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub"></a>
        <h1>CPAN digest</h1>
        For past
        <select id="offset">
            <option value="1">day</option>
            <option value="2">2 days</option>
            <option value="3">3 days</option>
            <option value="4">4 days</option>
            <option value="5">5 days</option>
            <option value="6">6 days</option>
            <option value="7">7 days</option>
        </select>
        <ol id="list" />
    </body>
</html>
